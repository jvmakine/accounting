<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Accounting</title>
		<link rel="stylesheet" type="text/css" href="/css/accounting.css">
		<link rel="stylesheet" type="text/css" href="/css/cupertino/jquery-ui-1.10.2.custom.min.css">
		<script type="text/javascript" src="/js/jquery-1.9.1.js"></script>
		<script type="text/javascript" src="/js/jquery-ui-1.10.2.custom.min.js"></script>
		<script type="text/javascript" src="/js/decorator.js"></script>
		<script type="text/javascript" src="/js/underscore-min.js"></script>
		<script type="text/javascript" src="/js/backbone-min.js"></script>
		<script type="text/javascript" src="/js/accounting.js"></script>
		<script type="text/javascript">
		
			var makeAccountAccordion = function() {
			  $("#account_container").accordion({ collapsible: true, active: null });
			}
		
			var makeNewAccountDialog = function() {
				$("#new_account_dialog").dialog({
			      	autoOpen: false,
			      	height: 360,
			      	width: 350,
			      	modal: true,
			      	draggable: false,
			      	resizable: false,
			      	buttons: {
			        	"Create": function() {
				          	accounting.createAccount({
					            name: $("#new_account_name").val(),
					            description: $("#new_account_description").val()
					        });
				    	    $("#new_account_dialog").dialog("close");
			        	},
			        	"Cancel": function() { 
			          		$("#new_account_dialog").dialog("close"); 
			        	}
			      	}
	      		});
			}
			
			var clearNewAccountForm = function() {
				$("#new_account_name").val("");
				$("#new_account_description").val("");
			}
			
			$(function() {
			  makeAccountAccordion();
			  makeNewAccountDialog();
			  $("#new_account_button").click(function(e){
			    clearNewAccountForm();
			    $("#new_account_dialog").dialog("open");
			  })
			  accounting.init({
			    onAccountRefresh: function() {
					$("#account_container").accordion('destroy');
					makeAccountAccordion();
			    }
			  });
			});
		</script>
	</head>
	<body>
		<script type="text/template" id="account_template">
			<h3 class="account-name" account-id="<%= id %>"><%= name %></h3>
			<div class="account-description"><%= description %></div>
		</script>
		<div>
			<a href="/logout">Logout</a>
			<a href="#" id="new_account_button">New Account</a>
		</div>
		<div class="accounts" id="account_container"></div>
		
		<div id="new_account_dialog" title="Create new account">
			<form>
    			<div class="form-element">
    				<label for="name">Name</label>
    				<input type="text" name="name" id="new_account_name" class="text ui-widget-content ui-corner-all" />
    			</div>
    			<div class="form-element">
    				<label for="description">Description</label>
    				<textarea name="description" id="new_account_description" class="textarea ui-widget-content ui-corner-all"></textarea>
    			</div>
  			</form>
		</div>
	</body>
</html>